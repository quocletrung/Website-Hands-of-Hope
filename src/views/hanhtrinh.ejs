<%- include('partials/navigation_bar.ejs') %>

<link rel="stylesheet" href="/css/main_bar.css">
<link rel="stylesheet" href="/css/trangchu.css">
<link rel="stylesheet" href="/css/hanhtrinh.css">

<link rel="stylesheet" href="/css/leaderboard.css">
<%- include('partials/leaderboard.ejs') %>


<% var posts = typeof posts !== 'undefined' ? posts : []; %>




<main class="hanhtrinh-container">
    <% if (typeof success_msg !== 'undefined') { %>
        <div class="message success-message"><%= success_msg %></div>
    <% } %>
    <% if (typeof error_msg !== 'undefined') { %>
        <div class="message error-message"><%= error_msg %></div>
    <% } %>
    <% if (user) { %>
        <form action="/volunteer/dang-bai" method="POST" class="post-form">
            <h3>Đăng bài tuyển tình nguyện viên</h3>
            <div>
                <label>Tiêu đề:</label>
                <input type="text" name="title" required>
            </div>
            <div>
                <label>Nội dung:</label>
                <textarea name="content" required></textarea>
            </div>
            <div>
                <label>Link ảnh (nếu có):</label>
                <input type="text" name="image_url">
            </div>
            <div>
                <label>Địa điểm:</label>
                <input type="text" name="location">
            </div>
            <div>
                <label>Ngày tổ chức:</label>
                <input type="date" name="event_date">
            </div>
            <button type="submit" class="submit-btn">Đăng bài</button>
        </form>
    <% } else { %>
        <p>Bạn cần <a href="/login">đăng nhập</a> để đăng bài.</p>
    <% } %>

    <h3>Danh sách bài tuyển tình nguyện viên</h3>

    <% if (posts && posts.length > 0) { %>
        <% posts.forEach(post => { %>
            <div class="post-card">
                <div class="post-header">
                    <img src="<%= post.author && post.author.avatar_url ? post.author.avatar_url : '/img/default-avatar.png' %>"
                         alt="avatar"
                         class="avatar">
                    <div>
                        <strong><%= post.author ? post.author.full_name : 'Ẩn danh' %></strong>
                        <div class="post-date">
                            <%= post.created_at.toLocaleString('vi-VN', {
                                hour: '2-digit',
                                minute: '2-digit',
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric'
                            }) %>
                        </div>
                    </div>
                </div>
                <h4 class="post-title"><%= post.title %></h4>
                <p class="post-content"><%= post.content %></p>
                <% if (post.image_url) { %>
                    <img src="<%= post.image_url %>" class="post-image">
                <% } %>

                <% if (user) { %>
                    <form action="/volunteer/tham-gia/<%= post.id %>" method="POST">
                        <button type="submit" class="green-btn">Tham gia</button>
                    </form>
                <% } else { %>
                    <a href="/login" class="green-btn">Đăng nhập để tham gia</a>
                <% } %>
            </div>
        <% }) %>
    <% } else { %>
        <p>Chưa có bài tuyển nào.</p>
    <% } %>
</main>

<%- include('partials/footer.ejs') %>
