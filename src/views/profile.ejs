<h2>Thay đổi Avatar</h2>
<form id="avatarUploadForm" action="/user/upload-avatar" method="POST" enctype="multipart/form-data">
    <div>
        <label for="avatarInput">Chọn ảnh đại diện mới:</label>
        <input type="file" id="avatarInput" name="avatar" accept="image/*" required>
    </div>
    <button type="submit">Tải lên</button>
</form>

<img id="currentAvatar" src="<%= user.avatarUrl || '/images/default-avatar.png' %>" alt="Avatar hiện tại" width="150">
<div id="previewContainer" style="margin-top: 10px;">
    <img id="avatarPreview" src="#" alt="Xem trước ảnh" width="150" style="display: none;">
</div>

<script>
    // (Tùy chọn) Xem trước ảnh trước khi upload
    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');
    const previewContainer = document.getElementById('previewContainer');

    if (avatarInput) {
        avatarInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    avatarPreview.src = e.target.result;
                    avatarPreview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            } else {
                avatarPreview.src = '#';
                avatarPreview.style.display = 'none';
            }
        });
    }

    // (Tùy chọn) Xử lý form submit bằng AJAX để không reload trang
    // const avatarUploadForm = document.getElementById('avatarUploadForm');
    // if (avatarUploadForm) {
    //     avatarUploadForm.addEventListener('submit', async function(event) {
    //         event.preventDefault();
    //         const formData = new FormData(this);
    //         try {
    //             const response = await fetch('/user/upload-avatar', { // Hoặc URL route của bạn
    //                 method: 'POST',
    //                 body: formData
    //             });
    //             const result = await response.json();
    //             if (response.ok) {
    //                 alert(result.message);
    //                 document.getElementById('currentAvatar').src = result.avatarUrl; // Cập nhật avatar mới
    //                 avatarPreview.style.display = 'none'; // Ẩn preview
    //                 this.reset(); // Reset form
    //             } else {
    //                 alert('Lỗi: ' + result.message);
    //             }
    //         } catch (error) {
    //             console.error('Lỗi khi upload avatar:', error);
    //             alert('Đã xảy ra lỗi. Vui lòng thử lại.');
    //         }
    //     });
    // }
</script>