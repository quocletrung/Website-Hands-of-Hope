
<%

var leaderboard = typeof leaderboard !== 'undefined' ? leaderboard : [];

var currentUserLeaderboard = typeof currentUserLeaderboard !== 'undefined' ? currentUserLeaderboard : null; // Th√¥ng tin c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i n·∫øu c√≥ trong BXH
%>

<aside class="leaderboard-section">
    <h3 class="leaderboard-title">
        <!-- <i class="fas fa-trophy"></i>  -->
        üèÜ B·∫£ng V√†ng Tri √Çn
    </h3>
    <p class="leaderboard-subtitle">Vinh danh nh·ªØng tr√°i tim v√†ng ƒë√£ ƒë√≥ng g√≥p t√≠ch c·ª±c</p>
    <p class="leaderboard-subtitle"></p>
    
    <% if (leaderboard && leaderboard.length > 0) { %>
        <ol class="leaderboard-list">
            <% leaderboard.slice(0, 5).forEach((user, index) => { %> <%# Ch·ªâ hi·ªÉn th·ªã top 5 ho·∫∑c t√πy ch·ªânh %>
                <li class="leaderboard-item <%= user.rank === 1 ? 'rank-1' : (user.rank === 2 ? 'rank-2' : (user.rank === 3 ? 'rank-3' : '')) %> <%= user.isCurrentUser ? 'current-user-highlight' : '' %>">
                    <div class="leaderboard-rank">
                        <% if (user.rank === 1) { %>
                            <i class="fas fa-crown rank-icon gold"></i>
                        <% } else if (user.rank === 2) { %>
                            <i class="fas fa-crown rank-icon silver"></i>
                        <% } else if (user.rank === 3) { %>
                            <i class="fas fa-crown rank-icon bronze"></i>
                        <% } else { %>
                            <%= user.rank %>
                        <% } %>
                    </div>
                    <img src="<%= user.avatar_url || '/img/default-avatar.png' %>" alt="<%= user.full_name %>" class="leaderboard-avatar">
                    <div class="leaderboard-user-info">
                        <span class="leaderboard-name"><%= user.full_name %></span>
                        <span class="leaderboard-points">
                            <i class="fas fa-star points-icon"></i> <%= user.volunpoints || 0 %> ƒëi·ªÉm
                        </span>
                    </div>
                    <% if (user.rank <= 3) { %>
                        <span class="top-badge">Top <%= user.rank %></span>
                    <% } %>
                </li>
            <% }); %>
        </ol>

        <% if (currentUserLeaderboard && currentUserLeaderboard.rank > 5) { %>
             <%# Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i n·∫øu h·ªç kh√¥ng n·∫±m trong top hi·ªÉn th·ªã %>
            <div class="current-user-leaderboard-info">
                <h4>V·ªã tr√≠ c·ªßa b·∫°n:</h4>
                <div class="leaderboard-item current-user-highlight">
                     <div class="leaderboard-rank"><%= currentUserLeaderboard.rank %></div>
                     <img src="<%= currentUserLeaderboard.avatar_url || '/img/default-avatar.png' %>" alt="<%= currentUserLeaderboard.full_name %>" class="leaderboard-avatar">
                     <div class="leaderboard-user-info">
                         <span class="leaderboard-name"><%= currentUserLeaderboard.full_name %> (B·∫°n)</span>
                         <span class="leaderboard-points">
                             <i class="fas fa-star points-icon"></i> <%= currentUserLeaderboard.volunpoints || 0 %> ƒëi·ªÉm
                         </span>
                     </div>
                </div>
            </div>
        <% } %>

        <% if (leaderboard.length > 5) { %>
            <div class="leaderboard-actions">
                <a href="/leaderboard" class="btn btn-secondary btn-view-full-leaderboard">
                    <i class="fas fa-list-ol"></i> Xem ƒë·∫ßy ƒë·ªß b·∫£ng x·∫øp h·∫°ng
                </a>
            </div>
        <% } %>

    <% } else { %>
        <p class="leaderboard-empty">Ch∆∞a c√≥ d·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng. H√£y t√≠ch c·ª±c tham gia nh√©!</p>
    <% } %>
</aside>